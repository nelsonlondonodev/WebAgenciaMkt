const translations = {
  es: {
    badgeNew: "Nuevo",
    pricingMonthly: "Mensual",
    pricingAnnual: "Anual",
    pricingSave: "Ahorra 20%",
    serviceWordPressPriceMonthly: "Desde 800€ + 60€/mes",
    serviceWordPressPriceAnnual: "Desde 800€ + 576€/año",
    serviceSeoPriceMonthly: "Desde 300€/mes",
    serviceSeoPriceAnnual: "Desde 2880€/año",
    serviceLearnMore: "Saber más",
    modalCTA: "Pedir Presupuesto",
    modalTourDesc1:
      "Ofrece a tus clientes una experiencia inmersiva sin precedentes. Nuestros Tours Virtuales 360° son la herramienta definitiva para mostrar tu negocio de una forma realista, interactiva y accesible 24/7 desde cualquier dispositivo.",
    modalTourDesc2:
      "Totalmente compatibles e integrables con **Google Street View**, mejorando tu visibilidad y posicionamiento en Google Maps.",
    modalTourFeature1:
      "Ideal para Inmobiliarias, Hoteles, Restaurantes, Clínicas y Tiendas.",
    modalTourFeature2: "Fotografía de alta resolución y montaje profesional.",
    modalTourFeature3: "Navegación intuitiva y fluida.",
    modalTourFeature4: "Puntos de información interactivos opcionales.",
    modalWebMedidaDesc1:
      "Creamos soluciones web desde cero, totalmente personalizadas para tus necesidades. Si buscas un rendimiento superior, funcionalidades únicas y un diseño que se adapte perfectamente a tu marca, esta es tu solución.",
    modalWebMedidaDesc2:
      "Utilizamos las últimas tecnologías (HTML5, CSS3, JavaScript moderno) para construir sitios rápidos, seguros y escalables.",
    modalWebMedidaFeature1: "Diseño 100% único y exclusivo para tu marca.",
    modalWebMedidaFeature2:
      "Optimización máxima del rendimiento y velocidad de carga.",
    modalWebMedidaFeature3:
      "Código limpio, semántico y preparado para SEO desde el inicio.",
    modalWebMedidaFeature4:
      "Totalmente escalable para añadir nuevas funcionalidades en el futuro.",
    modalWordPressDesc1:
      "Aprovecha la potencia y flexibilidad del gestor de contenidos más popular del mundo. WordPress es la solución ideal para quienes buscan un sitio web profesional, robusto y fácil de autogestionar.",
    modalWordPressDesc2:
      "Te entregamos un sitio listo para usar, con un diseño personalizado y las funcionalidades que necesites, dándote formación para que puedas actualizar tu contenido sin depender de nadie.",
    modalWordPressFeature1:
      "Panel de administración intuitivo para gestionar tu contenido.",
    modalWordPressFeature2:
      "Enorme ecosistema de plugins para ampliar funcionalidades (tiendas online, reservas, etc.).",
    modalWordPressFeature3:
      "Diseños profesionales y adaptables a partir de temas premium o creados a medida.",
    modalWordPressFeature4:
      "Incluye nuestro plan de mantenimiento para que tu web esté siempre segura y actualizada.",
    modalSeoDesc1:
      "Tener una web increíble no sirve de nada si tus clientes no la encuentran. Nuestro servicio de SEO se encarga de posicionar tu página en los primeros resultados de Google para atraer tráfico relevante y cualificado.",
    modalSeoDesc2:
      "Trabajamos en todos los frentes: la optimización técnica de la web, la creación de contenido de valor y la estrategia de autoridad para convertirte en un referente en tu sector.",
    modalSeoFeature1: "Auditoría SEO completa y análisis de la competencia.",
    modalSeoFeature2: "Investigación y estrategia de palabras clave.",
    modalSeoFeature3: "Optimización On-Page (contenido, meta-tags, velocidad).",
    modalSeoFeature4:
      "Informes mensuales para medir el progreso y ajustar la estrategia.",
    modalBrandingDesc1:
      "Tu marca es mucho más que un logo; es la promesa que le haces a tus clientes. Nos encargamos de construir una identidad de marca sólida y coherente que te diferencie de la competencia y conecte emocionalmente con tu público.",
    modalBrandingDesc2:
      "Desde la estrategia inicial hasta el diseño de cada elemento visual, creamos una identidad memorable que refleja tus valores y tu visión.",
    modalBrandingFeature1: "Diseño de logotipo y variaciones.",
    modalBrandingFeature2:
      "Definición de paleta de colores y tipografías corporativas.",
    modalBrandingFeature3: "Creación de manual de identidad visual.",
    modalBrandingFeature4: "Diseño de papelería y material de marketing.",
    navHome: "Inicio",
    navServices: "Servicios",
    navProjects: "Proyectos",
    navAbout: "Sobre Mí",
    navContact: "Contacto",
    openMenu: "Abrir menú principal",
    heroTitle1: "Transformamos Ideas en",
    heroTitle2: "Experiencias Digitales Impactantes",
    heroSubtitle:
      "Desde Madrid, con pasión colombiana y visión global. Creamos soluciones web innovadoras, SEO estratégico y los revolucionarios Tours Virtuales 360° para llevar tu negocio al siguiente nivel.",
    heroCTA: "Descubre Nuestros Servicios",
    servicesTitle: "Nuestros Servicios",
    servicesSubtitle:
      "Soluciones a medida para impulsar tu presencia online y alcanzar tus objetivos. Precios transparentes y posibilidad de modelos de suscripción mensual.",
    serviceTourTitle: "Tours Virtuales de Negocios 360°",
    serviceTourDesc:
      "Nuevo Servicio Estrella. Experiencias inmersivas compatibles con Google Street View. Ideal para inmobiliarias, restaurantes, hoteles y más.",
    serviceTourPrice: "Desde 499€",
    serviceSubscriptionInfo: "(Mantenimiento y soporte)",
    serviceCustomWebTitle: "Desarrollo Web a Medida",
    serviceCustomWebDesc:
      "Soluciones únicas con código nativo (HTML, CSS, JavaScript, y más) para un rendimiento y personalización máximos.",
    serviceCustomWebPrice: "Desde 1200€",
    serviceWordPressTitle: "Desarrollo Web con WordPress",
    serviceWordPressDesc:
      "Sitios web profesionales y autogestionables con el CMS más popular del mundo. Flexibilidad y potencia.",
    serviceSeoTitle: "SEO (Optimización para Buscadores)",
    serviceSeoDesc:
      "Mejora la visibilidad de tu web en Google y otros buscadores. Atraer tráfico orgánico cualificado es clave.",
    serviceBrandingTitle: "Creación de Marca (Branding)",
    serviceBrandingDesc:
      "Definimos y diseñamos la identidad visual de tu negocio para que conecte con tu audiencia y transmita tus valores.",
    serviceBrandingPrice: "Desde 600€",
    projectsTitle: "Nuestro Portafolio",
    projectsSubtitle:
      "Una muestra de la calidad y diversidad de nuestros trabajos. Clientes satisfechos son nuestra mejor carta de presentación.",
    project1Title: "Cliente Actual Importante",
    project1Category: "Desarrollo Web y Tour Virtual 360°",
    project1Desc:
      "Descripción breve del proyecto destacando el impacto y la solución aportada.",
    project2Title: "Startup Tecnológica",
    project2Category: "Branding y Desarrollo WordPress",
    project2Desc:
      "Diseño de identidad de marca y web corporativa enfocada en la conversión.",
    project3Title: "Consultoría SEO Local",
    project3Category: "Optimización SEO y Contenido",
    project3Desc:
      "Estrategia SEO que duplicó la visibilidad online del cliente en 6 meses.",
    projectsCTA: "Ver Más Proyectos",
    aboutTitle: "Conoce a Nelson Londoño",
    aboutIntro:
      "Soy Nelson Londoño, un desarrollador de 43 años originario de Colombia y afincado en Madrid. Mi pasión por la tecnología y el desarrollo de software no es solo mi profesión, es mi vocación.",
    aboutExperience:
      'Con años de experiencia en el sector, he fundado "Nelson Londoño Agencia" con la misión de ofrecer soluciones digitales que no solo cumplan, sino que superen las expectativas. Creemos en la cercanía, la transparencia y en construir relaciones de confianza a largo plazo con nuestros clientes.',
    aboutPhilosophy:
      "Nuestra filosofía se basa en la profesionalidad, la modernidad y una constante adaptación a las nuevas tendencias, como nuestros innovadores Tours Virtuales 360°. Queremos ser tu socio tecnológico en Madrid y más allá.",
    aboutCTA: "Hablemos de tu Proyecto",
    contactTitle: "Contacta Ahora",
    contactSubtitle:
      "¿Listo para iniciar tu próximo proyecto o tienes alguna pregunta? Estamos aquí para ayudarte.",
    formFirstName: "Nombre",
    formLastName: "Apellidos",
    formEmail: "Email",
    formPhone: "Teléfono (Opcional)",
    formServiceInterest: "Servicio de Interés",
    optionSelectService: "Selecciona un servicio...",
    optionTourVirtual: "Tour Virtual 360°",
    optionWebMedida: "Desarrollo Web a Medida",
    optionWordPress: "Desarrollo Web con WordPress",
    optionSEO: "SEO",
    optionBranding: "Branding",
    optionOtro: "Otro",
    formMessage: "Mensaje",
    formSubmit: "Enviar Mensaje",
    contactOrCall: "O si lo prefieres:",
    contactPhone: "+34 (000) 000-000",
    footerText: `&copy; ${new Date().getFullYear()} Nelson Londoño Agencia. Todos los derechos reservados.`,
    footerMadeWith:
      'Diseñado con <i class="fas fa-heart text-red-500"></i> en Madrid.',
  },
  en: {
    badgeNew: "New",
    pricingMonthly: "Monthly",
    pricingAnnual: "Annual",
    pricingSave: "Save 20%",
    serviceWordPressPriceMonthly: "From €800 + €60/mo",
    serviceWordPressPriceAnnual: "From €800 + €576/yr",
    serviceSeoPriceMonthly: "From €300/mo",
    serviceSeoPriceAnnual: "From €2880/yr",
    serviceLearnMore: "Learn more",
    modalCTA: "Request Quote",
    modalTourDesc1:
      "Offer your clients an unprecedented immersive experience. Our 360° Virtual Tours are the ultimate tool to showcase your business in a realistic, interactive, and accessible way, 24/7 from any device.",
    modalTourDesc2:
      "Fully compatible and integrable with **Google Street View**, enhancing your visibility and ranking on Google Maps.",
    modalTourFeature1:
      "Ideal for Real Estate, Hotels, Restaurants, Clinics, and Shops.",
    modalTourFeature2: "High-resolution photography and professional assembly.",
    modalTourFeature3: "Intuitive and smooth navigation.",
    modalTourFeature4: "Optional interactive information points.",
    modalWebMedidaDesc1:
      "We create web solutions from scratch, fully customized to your needs. If you are looking for superior performance, unique features, and a design that perfectly fits your brand, this is your solution.",
    modalWebMedidaDesc2:
      "We use the latest technologies (HTML5, CSS3, modern JavaScript) to build fast, secure, and scalable sites.",
    modalWebMedidaFeature1: "100% unique and exclusive design for your brand.",
    modalWebMedidaFeature2:
      "Maximum optimization of performance and loading speed.",
    modalWebMedidaFeature3:
      "Clean, semantic code prepared for SEO from the start.",
    modalWebMedidaFeature4: "Fully scalable to add new features in the future.",
    modalWordPressDesc1:
      "Leverage the power and flexibility of the world's most popular content management system. WordPress is the ideal solution for those looking for a professional, robust, and easy-to-manage website.",
    modalWordPressDesc2:
      "We deliver a ready-to-use site with a custom design and the functionalities you need, providing training so you can update your content without depending on anyone.",
    modalWordPressFeature1:
      "Intuitive administration panel to manage your content.",
    modalWordPressFeature2:
      "Huge ecosystem of plugins to expand functionalities (online stores, bookings, etc.).",
    modalWordPressFeature3:
      "Professional and responsive designs from premium or custom-built themes.",
    modalWordPressFeature4:
      "Includes our maintenance plan to keep your site always secure and up-to-date.",
    modalSeoDesc1:
      "Having an amazing website is useless if your customers can't find it. Our SEO service positions your page in Google's top results to attract relevant and qualified traffic.",
    modalSeoDesc2:
      "We work on all fronts: technical website optimization, valuable content creation, and authority-building strategy to make you a leader in your industry.",
    modalSeoFeature1: "Complete SEO audit and competitor analysis.",
    modalSeoFeature2: "Keyword research and strategy.",
    modalSeoFeature3: "On-Page optimization (content, meta-tags, speed).",
    modalSeoFeature4:
      "Monthly reports to measure progress and adjust the strategy.",
    modalBrandingDesc1:
      "Your brand is much more than a logo; it's the promise you make to your customers. We build a solid and coherent brand identity that sets you apart from the competition and emotionally connects with your audience.",
    modalBrandingDesc2:
      "From the initial strategy to the design of every visual element, we create a memorable identity that reflects your values and vision.",
    modalBrandingFeature1: "Logo design and variations.",
    modalBrandingFeature2:
      "Definition of color palette and corporate typographies.",
    modalBrandingFeature3: "Creation of a visual identity manual.",
    modalBrandingFeature4: "Design of stationery and marketing materials.",
    navHome: "Home",
    navServices: "Services",
    navProjects: "Projects",
    navAbout: "About Me",
    navContact: "Contact",
    openMenu: "Open main menu",
    heroTitle1: "We Transform Ideas Into",
    heroTitle2: "Impactful Digital Experiences",
    heroSubtitle:
      "From Madrid, with Colombian passion and global vision. We create innovative web solutions, strategic SEO, and revolutionary 360° Virtual Tours to take your business to the next level.",
    heroCTA: "Discover Our Services",
    servicesTitle: "Our Services",
    servicesSubtitle:
      "Tailored solutions to boost your online presence and achieve your goals. Transparent pricing and monthly subscription models available.",
    serviceTourTitle: "360° Business Virtual Tours",
    serviceTourDesc:
      "New Star Service. Immersive experiences compatible with Google Street View. Ideal for real estate, restaurants, hotels, and more.",
    serviceTourPrice: "From €499",
    serviceSubscriptionInfo: "(Maintenance and support)",
    serviceCustomWebTitle: "Custom Web Development",
    serviceCustomWebDesc:
      "Unique solutions with native code (HTML, CSS, JavaScript, and more) for maximum performance and customization.",
    serviceCustomWebPrice: "From €1200",
    serviceWordPressTitle: "WordPress Web Development",
    serviceWordPressDesc:
      "Professional and self-manageable websites with the world's most popular CMS. Flexibility and power.",
    serviceSeoTitle: "SEO (Search Engine Optimization)",
    serviceSeoDesc:
      "Improve your website's visibility on Google and other search engines. Attracting qualified organic traffic is key.",
    serviceBrandingTitle: "Branding (Brand Creation)",
    serviceBrandingDesc:
      "We define and design your business's visual identity to connect with your audience and convey your values.",
    serviceBrandingPrice: "From €600",
    projectsTitle: "Our Portfolio",
    projectsSubtitle:
      "A showcase of the quality and diversity of our work. Satisfied clients are our best introduction.",
    project1Title: "Key Current Client",
    project1Category: "Web Development & 360° Virtual Tour",
    project1Desc:
      "Brief project description highlighting the impact and solution provided.",
    project2Title: "Tech Startup",
    project2Category: "Branding & WordPress Development",
    project2Desc:
      "Brand identity design and corporate website focused on conversion.",
    project3Title: "Local SEO Consultancy",
    project3Category: "SEO Optimization & Content",
    project3Desc:
      "SEO strategy that doubled the client's online visibility in 6 months.",
    projectsCTA: "View More Projects",
    aboutTitle: "Meet Nelson Londoño",
    aboutIntro:
      "I'm Nelson Londoño, a 43-year-old developer originally from Colombia and based in Madrid. My passion for technology and software development is not just my profession, it's my calling.",
    aboutExperience:
      'With years of experience in the sector, I founded "Nelson Londoño Agency" with the mission to offer digital solutions that not only meet but exceed expectations. We believe in closeness, transparency, and building long-term trusting relationships with our clients.',
    aboutPhilosophy:
      "Our philosophy is based on professionalism, modernity, and constant adaptation to new trends, like our innovative 360° Virtual Tours. We want to be your technological partner in Madrid and beyond.",
    aboutCTA: "Let's Talk About Your Project",
    contactTitle: "Contact Now",
    contactSubtitle:
      "Ready to start your next project or have any questions? We're here to help.",
    formFirstName: "First Name",
    formLastName: "Last Name",
    formEmail: "Email",
    formPhone: "Phone (Optional)",
    formServiceInterest: "Service of Interest",
    optionSelectService: "Select a service...",
    optionTourVirtual: "360° Virtual Tour",
    optionWebMedida: "Custom Web Development",
    optionWordPress: "WordPress Web Development",
    optionSEO: "SEO",
    optionBranding: "Branding",
    optionOtro: "Other",
    formMessage: "Message",
    formSubmit: "Send Message",
    contactOrCall: "Or if you prefer:",
    contactPhone: "+34 (000) 000-000",
    footerText: `&copy; ${new Date().getFullYear()} Nelson Londoño Agency. All rights reserved.`,
    footerMadeWith:
      'Designed with <i class="fas fa-heart text-red-500"></i> in Madrid.',
  },
};

document.addEventListener("DOMContentLoaded", () => {
  const currentYearSpan = document.getElementById("currentYear");
  if (currentYearSpan) {
    currentYearSpan.textContent = new Date().getFullYear();
  }

  // --- MANEJO DEL HEADER CON SCROLL ---
  const mainHeader = document.getElementById("mainHeader");
  if (mainHeader) {
    const scrollThreshold = 50;
    window.addEventListener("scroll", () => {
      if (window.scrollY > scrollThreshold) {
        mainHeader.classList.add("header-scrolled");
      } else {
        mainHeader.classList.remove("header-scrolled");
      }
    });
  }

  // --- MANEJO DEL MENÚ MÓVIL ---
  const mobileMenuButton = document.getElementById("mobileMenuButton");
  const mobileMenu = document.getElementById("mobileMenu");
  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
      const icon = mobileMenuButton.querySelector("i");
      if (icon) {
        icon.classList.toggle("fa-bars");
        icon.classList.toggle("fa-times");
      }
    });
    mobileMenu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.add("hidden");
        const icon = mobileMenuButton.querySelector("i");
        if (icon) {
          icon.classList.remove("fa-times");
          icon.classList.add("fa-bars");
        }
      });
    });
  }

  // --- MANEJO DEL TEMA (MODO CLARO/OSCURO/AUTOMÁTICO) ---
  const darkModeToggle = document.getElementById("darkModeToggle");
  if (darkModeToggle) {
    const themes = ["auto", "light", "dark"];
    let currentTheme = localStorage.getItem("theme") || "auto";

    const applyTheme = (theme) => {
      if (theme === "auto") {
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        document.documentElement.classList.toggle("dark", prefersDark);
      } else {
        document.documentElement.classList.toggle("dark", theme === "dark");
      }
    };

    const updateIcon = (theme) => {
      const iconElement = darkModeToggle.querySelector("i");
      if (iconElement) {
        iconElement.classList.remove(
          "fa-sun",
          "fa-moon",
          "fa-circle-half-stroke"
        );
        if (theme === "light") {
          iconElement.classList.add("fa-sun");
        } else if (theme === "dark") {
          iconElement.classList.add("fa-moon");
        } else {
          iconElement.classList.add("fa-circle-half-stroke");
        }
      }
    };

    darkModeToggle.addEventListener("click", () => {
      const currentThemeIndex = themes.indexOf(currentTheme);
      const nextThemeIndex = (currentThemeIndex + 1) % themes.length;
      currentTheme = themes[nextThemeIndex];
      localStorage.setItem("theme", currentTheme);
      applyTheme(currentTheme);
      updateIcon(currentTheme);
    });

    window
      .matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", () => {
        if (currentTheme === "auto") {
          applyTheme("auto");
        }
      });

    applyTheme(currentTheme);
    updateIcon(currentTheme);
  }

  // --- MANEJO DEL SELECTOR DE PRECIOS ---
  const priceToggle = document.getElementById("price-toggle");
  if (priceToggle) {
    const monthlyPrices = document.querySelectorAll(".price-monthly");
    const annualPrices = document.querySelectorAll(".price-annual");
    let isAnnual = localStorage.getItem("pricingMode") === "annual";

    function setPricingMode(isAnnualMode) {
      isAnnual = isAnnualMode;
      localStorage.setItem("pricingMode", isAnnual ? "annual" : "monthly");
      priceToggle.classList.toggle("toggled", isAnnual);
      monthlyPrices.forEach((price) =>
        price.classList.toggle("hidden", isAnnual)
      );
      annualPrices.forEach((price) =>
        price.classList.toggle("hidden", !isAnnual)
      );
    }

    priceToggle.addEventListener("click", () => {
      setPricingMode(!isAnnual);
    });

    setPricingMode(isAnnual);
  }

  // --- MANEJO DEL IDIOMA ---
  const languageSwitcher = document.getElementById("languageSwitcher");
  if (languageSwitcher) {
    let currentLang = localStorage.getItem("language") || "es";

    function setLanguage(lang) {
      const langIndicator = document.getElementById("langIndicator");
      if (!langIndicator) {
        console.error(
          "CRITICAL: El elemento #langIndicator no existe en el HTML."
        );
        return;
      }

      currentLang = lang;
      localStorage.setItem("language", lang);
      document.documentElement.lang = lang;
      document.body.setAttribute("data-lang", lang);

      langIndicator.innerHTML =
        lang === "es"
          ? '<span role="img" aria-label="Bandera de Reino Unido">🇬🇧</span> EN'
          : '<span role="img" aria-label="Bandera de España">🇪🇸</span> ES';

      document.querySelectorAll("[data-translate-key]").forEach((el) => {
        const key = el.getAttribute("data-translate-key");
        const translation = translations[lang]?.[key];
        if (translation) {
          if (key === "footerMadeWith" || key === "footerText") {
            el.innerHTML = translation;
          } else {
            el.textContent = translation;
          }
        }
      });
    }

    languageSwitcher.addEventListener("click", () => {
      setLanguage(currentLang === "es" ? "en" : "es");
    });

    setLanguage(currentLang);
  }

  // --- MANEJO DE SCROLL SUAVE ---
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault();
      const targetId = this.getAttribute("href");
      const targetElement = document.querySelector(targetId);
      if (targetElement) {
        const headerOffset =
          document.getElementById("mainHeader")?.offsetHeight || 80;
        const elementPosition = targetElement.getBoundingClientRect().top;
        const offsetPosition =
          elementPosition + window.pageYOffset - headerOffset;
        window.scrollTo({ top: offsetPosition, behavior: "smooth" });
      }
    });
  });

  // --- MANEJO DE ANIMACIONES AL HACER SCROLL (CORREGIDO) ---
  const animatedElements = document.querySelectorAll(
    ".card-container, .service-card, .portfolio-item, #sobre-mi h2, #sobre-mi p, #sobre-mi img"
  );
  if (typeof IntersectionObserver !== "undefined") {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.remove("scroll-animate-initial");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1 }
    );

    animatedElements.forEach((el) => {
      observer.observe(el);
    });
  }

  // --- MANEJO DE SCROLLSPY ---
  const sections = document.querySelectorAll("section[id]");
  const navLinks = document.querySelectorAll("header nav a");
  if (sections.length > 0 && navLinks.length > 0) {
    const observerOptions = {
      root: null,
      rootMargin: "0px 0px -60% 0px",
      threshold: 0,
    };

    const sectionObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const sectionId = entry.target.id;
          navLinks.forEach((link) => {
            link.classList.remove("nav-active");
            if (link.getAttribute("href") === `#${sectionId}`) {
              link.classList.add("nav-active");
            }
          });
        }
      });
    }, observerOptions);

    sections.forEach((section) => {
      sectionObserver.observe(section);
    });
  }

  // --- MANEJO DEL FILTRO DEL PORTAFOLIO ---
  const filtersContainer = document.getElementById("portfolio-filters");
  const portfolioItems = document.querySelectorAll(
    "#portfolio-grid .portfolio-item"
  );

  if (filtersContainer && portfolioItems.length > 0) {
    filtersContainer.addEventListener("click", (e) => {
      // Nos aseguramos de que el clic fue en un BOTÓN dentro del contenedor
      if (e.target.matches("button.filter-btn")) {
        const clickedButton = e.target;

        // Evitamos ejecutar el filtro si el botón ya está activo
        if (clickedButton.classList.contains("active-filter")) {
          return;
        }

        // Cambiamos el estilo del botón activo
        filtersContainer
          .querySelector(".active-filter")
          .classList.remove("active-filter");
        clickedButton.classList.add("active-filter");

        const filterValue = clickedButton.dataset.filter;

        // Recorremos cada proyecto para decidir si lo mostramos o lo ocultamos
        portfolioItems.forEach((item) => {
          const itemCategories = item.dataset.category;

          if (filterValue === "all" || itemCategories.includes(filterValue)) {
            item.classList.remove("project-hidden");
          } else {
            item.classList.add("project-hidden");
          }
        });
      }
    });
  }

  // --- MANEJO GENÉRICO DE MODALES ---
  function openModal(modal) {
    if (modal) {
      modal.classList.remove("hidden");
      modal.classList.add("flex");
      document.body.classList.add("overflow-hidden");
    }
  }

  function closeModal(modal) {
    if (modal) {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
      document.body.classList.remove("overflow-hidden");
    }
  }

  const modalConfigs = [
    {
      cardId: "card-proyecto-barberia",
      modalId: "proyecto-modal-barberia",
    },
    { cardId: "card-proyecto-kuula", modalId: "proyecto-modal-kuula" },
    { cardId: "card-tours-virtuales", modalId: "service-modal-tours" },
    { cardId: "card-web-medida", modalId: "service-modal-web-medida" },
    { cardId: "card-wordpress", modalId: "service-modal-wordpress" },
    { cardId: "card-seo", modalId: "service-modal-seo" },
    { cardId: "card-branding", modalId: "service-modal-branding" },
  ];

  modalConfigs.forEach((config) => {
    const card = document.getElementById(config.cardId);
    const modal = document.getElementById(config.modalId);
    if (card && modal) {
      card.addEventListener("click", () => openModal(modal));
    }
  });

  const allModals = document.querySelectorAll(
    '[id^="service-modal-"], [id^="proyecto-modal-"]'
  );
  allModals.forEach((modal) => {
    const closeModalBtn = modal.querySelector('button[id^="close-modal-"]');
    if (closeModalBtn) {
      closeModalBtn.addEventListener("click", () => closeModal(modal));
    }

    modal.addEventListener("click", (event) => {
      if (event.target === modal) {
        closeModal(modal);
      }
    });

    modal.querySelectorAll(".modal-contact-button").forEach((button) => {
      button.addEventListener("click", () => closeModal(modal));
    });
  });

  window.addEventListener("keydown", (event) => {
    if (event.key === "Escape") {
      allModals.forEach((modal) => {
        if (!modal.classList.contains("hidden")) {
          closeModal(modal);
        }
      });
    }
  });
});
