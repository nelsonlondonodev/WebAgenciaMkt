(()=>{function k(){let n=document.getElementById("darkModeToggle");if(n){let e=["auto","light","dark"],t=localStorage.getItem("theme")||"auto",i=r=>{if(r==="auto"){let s=window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",s)}else document.documentElement.classList.toggle("dark",r==="dark")},a=r=>{let s=n.querySelector("i");s&&(s.classList.remove("fa-sun","fa-moon","fa-circle-half-stroke"),r==="light"?s.classList.add("fa-sun"):r==="dark"?s.classList.add("fa-moon"):s.classList.add("fa-circle-half-stroke"))};n.addEventListener("click",()=>{let s=(e.indexOf(t)+1)%e.length;t=e[s],localStorage.setItem("theme",t),i(t),a(t)}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{t==="auto"&&i("auto")}),i(t),a(t)}}function L(){document.body.classList.add("fade-in");function n(t){let i=document.querySelector(t);if(i){let a=document.getElementById("mainHeader")?.offsetHeight||80,s=i.getBoundingClientRect().top+window.pageYOffset-a;window.scrollTo({top:s,behavior:"smooth"})}}function e(t,i){document.body.classList.add("fade-out"),setTimeout(()=>{i?(n(t),setTimeout(()=>{document.body.classList.remove("fade-out")},50)):window.location.href=t},300)}document.querySelectorAll('a:not([href^="tel:"]):not([href^="mailto:"]):not(.social-share-btn):not(.modal-contact-button):not([target="_blank"])').forEach(t=>{t.addEventListener("click",function(i){let a=this.getAttribute("href");if(!a||a==="#")return;let r=a.startsWith("#"),s=r||a.split("#")[0]===window.location.pathname.split("/").pop()||a.split("#")[0]==="";(this.hostname===window.location.hostname||a.startsWith("/"))&&(i.preventDefault(),e(a,r&&s))})})}var v=typeof IntersectionObserver<"u"?new IntersectionObserver(n=>{n.forEach(e=>{e.isIntersecting&&(e.target.classList.add("is-visible"),v.unobserve(e.target))})},{threshold:.1}):null;function b(n){if(!v||!n)return;(n instanceof NodeList?Array.from(n):[n]).forEach((t,i)=>{t.classList.contains("scroll-animate-initial")&&(t.style.transitionDelay=`${30*i}ms`,v.observe(t))})}function w(){let n=document.querySelectorAll(".scroll-animate-initial");n.length>0&&b(n)}function H(){let n=document.createElement("div");return n.id="nav-overlay",n.className="fixed inset-0 bg-black/50 z-10 hidden",document.body.appendChild(n),n}function $(){let n=document.getElementById("mobileMenuButton"),e=document.getElementById("mobileMenu"),t=H();if(!n||!e)return;let i=()=>{e.classList.add("hidden"),t.classList.add("hidden"),n.classList.remove("is-active")},a=()=>{e.classList.remove("hidden"),t.classList.remove("hidden"),n.classList.add("is-active")},r=()=>{e.classList.contains("hidden")?a():i()};n.addEventListener("click",s=>{s.stopPropagation(),r()}),t.addEventListener("click",i),e.addEventListener("click",s=>{s.target.closest("a")&&(s.target.closest("#mobileServicesButton")||i())})}function P(){let n=document.getElementById("mobileServicesButton"),e=document.getElementById("mobileServicesMenu");!n||!e||n.addEventListener("click",t=>{t.stopPropagation(),e.classList.toggle("hidden");let i=n.querySelector("i.fa-chevron-down");i&&i.classList.toggle("rotate-180")})}function F(){let n=document.querySelectorAll("section[id]"),e=document.querySelectorAll("header nav a");if(n.length===0||e.length===0)return;let t={root:null,rootMargin:"0px 0px -60% 0px",threshold:0},i=new IntersectionObserver(a=>{a.forEach(r=>{if(r.isIntersecting){let s=r.target.id;e.forEach(o=>{o.classList.remove("nav-active"),o.getAttribute("href")===`#${s}`&&o.classList.add("nav-active")})}})},t);n.forEach(a=>{i.observe(a)})}function _(){let n=document.getElementById("services-menu-group"),e=document.getElementById("services-menu-dropdown"),t;!n||!e||(n.addEventListener("mouseenter",()=>{clearTimeout(t),e.classList.remove("hidden")}),n.addEventListener("mouseleave",()=>{t=setTimeout(()=>{e.classList.add("hidden")},300)}))}function S(){$(),P(),F(),_()}function B(){let n=document.getElementById("portfolio-filters"),e=document.querySelectorAll("#portfolio-grid .portfolio-item");n&&e.length>0&&n.addEventListener("click",t=>{if(t.target.matches("button.filter-btn")){let i=t.target;if(i.classList.contains("active-filter"))return;n.querySelector(".active-filter").classList.remove("active-filter"),i.classList.add("active-filter");let a=i.dataset.filter;e.forEach(r=>{let s=r.dataset.category,o=a==="all"||s.includes(a);r.style.display=o?"block":"none"})}})}function j(n,e,t,i,a=0){let r=null;function s(o){r===null&&(r=o);let c=o-r,d=Math.min(c/i,1),l=e<t,m=t-e,f=e+m*d;d===1?n.textContent=parseFloat(t).toFixed(a):n.textContent=f.toFixed(a),d<1&&requestAnimationFrame(s)}requestAnimationFrame(s)}function C(){let n=document.querySelectorAll(".animate-number");if(n.length===0)return;let e=new IntersectionObserver((t,i)=>{t.forEach(a=>{if(a.isIntersecting){let r=a.target,s=parseFloat(r.dataset.endValue),o=parseFloat(r.dataset.startValue)||0,c=parseInt(r.dataset.duration,10)||2e3,d=parseInt(r.dataset.decimals,10)||0;if(isNaN(s)){console.error("El atributo data-end-value no es un n\xFAmero v\xE1lido.",r);return}j(r,o,s,c,d),i.unobserve(r)}})},{threshold:.5});n.forEach(t=>{e.observe(t)})}var h=async(n,e)=>{try{let t=await fetch(e);if(!t.ok)throw new Error(`Error al cargar el componente ${e}: ${t.statusText}`);let i=await t.text(),a=document.querySelector(n);a?a.innerHTML=i:console.warn(`No se encontr\xF3 el elemento con el selector: ${n}`)}catch(t){console.error(`No se pudo cargar el componente desde ${e}:`,t)}},M=async()=>{await Promise.all([h("#nav-placeholder","/components/nav.html"),h("#footer-placeholder","/components/footer.html"),h("#cookie-banner-placeholder","/components/cookie-banner.html")]),document.querySelector('[data-component="chatbot"]')&&await h('[data-component="chatbot"]',"/components/chatbot.html")};var T=()=>{let n=document.getElementById("currentYear");n&&(n.textContent=new Date().getFullYear())};var E=class{constructor(){this.elements={widgetButton:document.getElementById("chat-widget-button"),window:document.getElementById("chat-window"),closeButton:document.getElementById("close-chat-window"),sendButton:document.getElementById("chat-send"),input:document.getElementById("chat-input"),messages:document.getElementById("chat-messages")},this.elements.widgetButton&&(this.n8nWebhookUrl="https://n8n.srv1033442.hstgr.cloud/webhook/34b5ab96-ecf0-4195-93de-e3923c2062e5",this.sessionIdKey="nelson_chat_session_id",this.sessionId=this.getOrCreateSessionId(),this.historyKey=`nelson_chat_history_${this.sessionId}`,this.history=[],this.loadHistory(),this.addEventListeners())}getOrCreateSessionId(){let e=localStorage.getItem(this.sessionIdKey);return e||(e=Date.now().toString(36)+Math.random().toString(36).substring(2),localStorage.setItem(this.sessionIdKey,e)),e}loadHistory(){let e=sessionStorage.getItem(this.historyKey);e&&(this.history=JSON.parse(e),this.history.forEach(t=>{this.appendMessage(t.message,t.sender,!1)}))}addEventListeners(){this.elements.widgetButton.addEventListener("click",()=>this.toggleWindow()),this.elements.closeButton.addEventListener("click",()=>this.toggleWindow()),this.elements.sendButton.addEventListener("click",()=>this.sendMessage()),this.elements.input.addEventListener("keypress",e=>{e.key==="Enter"&&this.sendMessage()})}toggleWindow(){this.elements.window.classList.toggle("hidden"),this.elements.window.classList.contains("hidden")||(this.elements.input.focus(),this.history.length===0&&this.appendMessage("\xA1Hola! Soy Aurelio, tu asistente virtual. \xBFEn qu\xE9 puedo ayudarte?","bot"))}sendMessage(){let e=this.elements.input.value.trim();e!==""&&(this.appendMessage(e,"user"),this.elements.input.value="",this.showTypingIndicator(),this.sendToWebhook(e,this.sessionId))}async sendToWebhook(e,t){try{let a=await(await fetch(this.n8nWebhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,sessionId:t})})).json();this.removeTypingIndicator();let r=a.response||"Lo siento, no he podido procesar tu mensaje. Por favor, intenta de nuevo.";this.appendMessage(r,"bot")}catch(i){console.error("Error sending message to n8n:",i),this.removeTypingIndicator(),this.appendMessage("Lo siento, ha ocurrido un error de conexi\xF3n. Por favor, int\xE9ntalo m\xE1s tarde.","bot")}}createBubble(e,t){let i=document.createElement("div");return i.className=`py-2 px-4 inline-block max-w-xs ${t==="user"?"bg-primary-blue text-white rounded-t-lg rounded-bl-lg":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-t-lg rounded-br-lg"}`,i.innerHTML=e,i.querySelectorAll("a").forEach(a=>a.classList.add("text-blue-500","underline")),i}createTimestamp(){let e=new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),t=document.createElement("div");return t.className="text-xs text-gray-500 dark:text-gray-400 mt-1",t.textContent=e,t}appendMessage(e,t,i=!0){i&&(this.history.push({message:e,sender:t}),sessionStorage.setItem(this.historyKey,JSON.stringify(this.history)));let a=document.createElement("div");a.className=`mb-4 flex flex-col ${t==="user"?"items-end":"items-start"} animate-chat-message-in`;let r=this.createBubble(e,t),s=this.createTimestamp();a.appendChild(r),a.appendChild(s),this.elements.messages.appendChild(a),this.elements.messages.scrollTop=this.elements.messages.scrollHeight}showTypingIndicator(){let e=document.createElement("div");e.id="typing-indicator",e.className="mb-4",e.innerHTML=`
      <div class="bg-gray-200 dark:bg-gray-700 rounded-lg py-2 px-4 inline-block">
        <div class="flex items-center space-x-1">
          <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse"></span>
          <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></span>
          <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></span>
        </div>
      </div>`,this.elements.messages.appendChild(e),this.elements.messages.scrollTop=this.elements.messages.scrollHeight}removeTypingIndicator(){let e=document.getElementById("typing-indicator");e&&e.remove()}};function A(){new E}var O=[{url:"agencia-desarrollo-web-con-codigo.html",icon:"fas fa-code fa-2x",title:"Desarrollo web a medida",description:"Creamos soluciones web \xFAnicas y de alto rendimiento, dise\xF1adas espec\xEDficamente para tus necesidades y objetivos de negocio."},{url:"agencia-automatizaciones.html",icon:"fas fa-robot fa-2x",title:"Agentes virtuales y automatizaciones",description:"Implementamos IA y automatizaciones para optimizar tus operaciones, reducir costos y escalar el crecimiento de tu negocio."},{url:"agencia-seo.html",icon:"fas fa-search fa-2x",title:"SEO (optimizaci\xF3n para buscadores)",description:"Mejora la visibilidad de tu sitio web en los resultados de b\xFAsqueda org\xE1nica de Google y otros buscadores."},{url:"agencia-seo-local.html",icon:"fas fa-map-marker-alt fa-2x",title:"SEO local",description:"Atrae clientes cercanos a tu negocio f\xEDsico. Optimiza tu presencia en Google Maps y b\xFAsquedas locales."}];function W(n){return`
    <a
      href="${n.url}"
      class="service-card group hover:-translate-y-2 scroll-animate-initial cursor-pointer flex flex-col"
    >
      <div
        class="flex items-center justify-center w-16 h-16 mb-6 rounded-full bg-primary-green/20 dark:bg-primary-blue/20 text-glow-green dark:text-glow-blue group-hover:bg-primary-green dark:group-hover:bg-primary-blue group-hover:text-white transition-colors duration-300"
      >
        <i class="${n.icon}"></i>
      </div>
      <h3
        class="text-2xl md:text-3xl font-semibold mb-3 text-gray-900 dark:text-white"
      >
        ${n.title}
      </h3>
      <div
        class="text-base text-gray-600 dark:text-gray-400 mb-4 flex-grow"
      >
        <p class="mb-4">
          ${n.description}
        </p>
      </div>
    </a>
  `}function q(){let n=document.getElementById("services-container");if(!n)return;let e=O.map(W).join("");n.innerHTML=e;let t=n.querySelectorAll(".scroll-animate-initial");b(t)}document.addEventListener("DOMContentLoaded",async()=>{await M(),k(),L(),w(),S(),B(),C(),q(),T(),A(),n();function n(){function s(l){if(l){let m=l.querySelector("iframe[data-src]");m&&!m.src&&(m.src=m.dataset.src),l.classList.remove("hidden"),l.classList.add("flex"),document.body.classList.add("overflow-hidden")}}function o(l){l&&(l.classList.add("hidden"),l.classList.remove("flex"),document.body.classList.remove("overflow-hidden"))}[{cardId:"card-proyecto-locutorio",modalId:"proyecto-modal-locutorio"},{cardId:"card-proyecto-barberia",modalId:"proyecto-modal-barberia"},{cardId:"card-proyecto-kuula",modalId:"proyecto-modal-kuula"}].forEach(l=>{let m=document.getElementById(l.cardId),f=document.getElementById(l.modalId);m&&f&&m.addEventListener("click",()=>s(f))});let d=document.querySelectorAll('[id^="service-modal-"], [id^="proyecto-modal-"]');d.length>0&&(d.forEach(l=>{let m=l.querySelector('button[id^="close-modal-"]');m&&m.addEventListener("click",()=>o(l)),l.addEventListener("click",f=>{f.target===l&&o(l)}),l.querySelectorAll(".modal-contact-button").forEach(f=>{f.addEventListener("click",()=>o(l))})}),window.addEventListener("keydown",l=>{l.key==="Escape"&&d.forEach(m=>{m.classList.contains("hidden")||o(m)})}))}e();function e(){let s=document.querySelector("#contact-form");if(s){let o=document.getElementById("form-status"),c=s.querySelector('button[type="submit"]');s.addEventListener("submit",async function(d){if(d.preventDefault(),!s.checkValidity()){s.reportValidity(),o&&(o.textContent="Por favor, completa todos los campos requeridos.",o.className="text-center font-semibold mt-4 text-red-600",setTimeout(()=>{o.textContent=""},5e3));return}let l=new FormData(s);o&&(o.textContent="Enviando...",o.className="text-center font-semibold mt-4 text-gray-600 dark:text-gray-300"),c&&(c.disabled=!0);try{(await fetch(s.action,{method:"POST",body:l,headers:{Accept:"application/json"}})).ok?(o&&(o.textContent="\xA1Mensaje enviado con \xE9xito!",o.className="text-center font-semibold mt-4 text-green-600",setTimeout(()=>{o.textContent=""},5e3)),s.reset()):o&&(o.textContent="Hubo un error al enviar el mensaje. Int\xE9ntalo de nuevo.",o.className="text-center font-semibold mt-4 text-red-600",setTimeout(()=>{o.textContent=""},5e3))}catch{o&&(o.textContent="Hubo un problema de conexi\xF3n. Revisa tu internet.",o.className="text-center font-semibold mt-4 text-red-600",setTimeout(()=>{o.textContent=""},5e3))}finally{c&&setTimeout(()=>{c.disabled=!1},3e3)}})}}t();function t(){if(document.getElementById("contact-reveal-container")){let o=document.getElementById("reveal-email-btn"),c=document.getElementById("reveal-phone-btn");o&&o.addEventListener("click",d=>{d.currentTarget.outerHTML=`
          <a href="mailto:contacto@nelsonlondono.es" class="text-primary-blue dark:text-primary-green font-semibold hover:underline flex items-center">
            <i class="fas fa-envelope mr-2"></i>contacto@nelsonlondono.es
          </a>`},{once:!0}),c&&c.addEventListener("click",d=>{d.currentTarget.outerHTML=`
          <a href="tel:+34663975428" class="text-primary-blue dark:text-primary-green font-semibold hover:underline flex items-center">
            <i class="fas fa-phone mr-2"></i>+34 663 97 54 28
          </a>`},{once:!0})}}i();function i(){let s="nelson_cookie_consent",o=document.getElementById("cookie-banner"),c=document.getElementById("cookie-settings-modal"),d=document.getElementById("analytics-cookie-toggle"),l=document.getElementById("open-cookie-settings"),m=document.getElementById("cookie-accept"),f=document.getElementById("cookie-reject"),x=document.getElementById("cookie-settings-open"),I=document.getElementById("cookie-settings-save");function g(){let u=localStorage.getItem(s);return u?JSON.parse(u):null}function p(u){localStorage.setItem(s,JSON.stringify(u))}function y(){typeof gtag=="function"&&gtag("config","G-124QEKRXHD")}function N(){let u=g();u?(u.analytics&&y(),o&&o.classList.add("hidden")):o&&o.classList.remove("hidden")}l&&l.addEventListener("click",u=>{u.preventDefault();let D=g()||{analytics:!1};d&&(d.checked=D.analytics),c&&c.classList.remove("hidden")}),m&&m.addEventListener("click",()=>{p({necessary:!0,analytics:!0}),y(),o&&o.classList.add("hidden")}),f&&f.addEventListener("click",()=>{p({necessary:!0,analytics:!1}),o&&o.classList.add("hidden")}),x&&x.addEventListener("click",()=>{let u=g()||{analytics:!1};d&&(d.checked=u.analytics),c&&c.classList.remove("hidden")}),I&&I.addEventListener("click",()=>{let u={necessary:!0,analytics:d?d.checked:!1};p(u),u.analytics&&y(),c&&c.classList.add("hidden"),o&&o.classList.add("hidden")}),c&&c.addEventListener("click",u=>{u.target===c&&c.classList.add("hidden")}),N()}a();function a(){let s=document.getElementById("hero-iframe-container");s&&s.addEventListener("click",()=>{let o=document.getElementById("hero-iframe-placeholder"),c=document.getElementById("hero-iframe");c&&c.dataset.src&&(c.src=c.dataset.src,o&&o.classList.add("hidden"),c.classList.remove("hidden"),s.style.cursor="default")},{once:!0})}function r(){let s=document.getElementById("share-linkedin"),o=document.getElementById("share-whatsapp");if(s&&o){let c=window.location.href,d=document.title,l=document.querySelector('meta[name="description"]').getAttribute("content");c&&d&&l&&(s.href=`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(c)}&title=${encodeURIComponent(d)}&summary=${encodeURIComponent(l)}`,s.target="_blank",s.rel="noopener noreferrer",o.href=`https://api.whatsapp.com/send?text=${encodeURIComponent(d+" - Link: "+c)}`,o.target="_blank",o.rel="noopener noreferrer")}}r()});})();
