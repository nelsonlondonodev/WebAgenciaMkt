(()=>{function E(){let a=document.getElementById("darkModeToggle");if(a){let e=["auto","light","dark"],n=localStorage.getItem("theme")||"auto",i=d=>{if(d==="auto"){let o=window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",o)}else document.documentElement.classList.toggle("dark",d==="dark")},s=d=>{let o=a.querySelector("i");o&&(o.classList.remove("fa-sun","fa-moon","fa-circle-half-stroke"),d==="light"?o.classList.add("fa-sun"):d==="dark"?o.classList.add("fa-moon"):o.classList.add("fa-circle-half-stroke"))};a.addEventListener("click",()=>{let o=(e.indexOf(n)+1)%e.length;n=e[o],localStorage.setItem("theme",n),i(n),s(n)}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{n==="auto"&&i("auto")}),i(n),s(n)}}function L(){document.body.classList.add("fade-in");function a(n){let i=document.querySelector(n);if(i){let s=document.getElementById("mainHeader")?.offsetHeight||80,o=i.getBoundingClientRect().top+window.pageYOffset-s;window.scrollTo({top:o,behavior:"smooth"})}}function e(n,i){document.body.classList.add("fade-out"),setTimeout(()=>{i?(a(n),setTimeout(()=>{document.body.classList.remove("fade-out")},50)):window.location.href=n},300)}document.querySelectorAll('a:not([href^="tel:"]):not([href^="mailto:"]):not(.social-share-btn):not(.modal-contact-button):not([target="_blank"])').forEach(n=>{n.addEventListener("click",function(i){let s=this.getAttribute("href");if(!s||s==="#")return;let d=s.startsWith("#"),o=d||s.split("#")[0]===window.location.pathname.split("/").pop()||s.split("#")[0]==="";(this.hostname===window.location.hostname||s.startsWith("/"))&&(i.preventDefault(),e(s,d&&o))})})}function I(){let a=document.querySelectorAll(".scroll-animate-initial");if(a.length>0&&typeof IntersectionObserver<"u"){let e=new IntersectionObserver(n=>{n.forEach(i=>{i.isIntersecting&&(i.target.classList.add("is-visible"),e.unobserve(i.target))})},{threshold:.1});a.forEach((n,i)=>{n.style.transitionDelay=`${30*i}ms`,e.observe(n)})}}function x(){let a=document.getElementById("mobileMenuButton"),e=document.getElementById("mobileMenu"),n=document.getElementById("mobileServicesButton");if(!a||!e)return;let i=()=>{if(!e.classList.contains("hidden")){e.classList.add("hidden");let s=a.querySelector("i");s&&(s.classList.remove("fa-times"),s.classList.add("fa-bars"))}};a.addEventListener("click",s=>{s.stopPropagation(),e.classList.toggle("hidden");let d=a.querySelector("i");d&&(d.classList.toggle("fa-bars"),d.classList.toggle("fa-times"))}),e.addEventListener("click",s=>{s.target.closest("a")&&(s.target.closest("#mobileServicesButton")||i())}),document.addEventListener("click",s=>{!e.contains(s.target)&&!a.contains(s.target)&&i()})}function M(){let a=document.getElementById("mobileServicesButton"),e=document.getElementById("mobileServicesMenu");!a||!e||a.addEventListener("click",n=>{n.stopPropagation(),e.classList.toggle("hidden");let i=a.querySelector("i.fa-chevron-down");i&&i.classList.toggle("rotate-180")})}function T(){let a=document.querySelectorAll("section[id]"),e=document.querySelectorAll("header nav a");if(a.length===0||e.length===0)return;let n={root:null,rootMargin:"0px 0px -60% 0px",threshold:0},i=new IntersectionObserver(s=>{s.forEach(d=>{if(d.isIntersecting){let o=d.target.id;e.forEach(t=>{t.classList.remove("nav-active"),t.getAttribute("href")===`#${o}`&&t.classList.add("nav-active")})}})},n);a.forEach(s=>{i.observe(s)})}function C(){let a=document.getElementById("services-menu-group"),e=document.getElementById("services-menu-dropdown"),n;!a||!e||(a.addEventListener("mouseenter",()=>{clearTimeout(n),e.classList.remove("hidden")}),a.addEventListener("mouseleave",()=>{n=setTimeout(()=>{e.classList.add("hidden")},300)}))}function k(){x(),M(),T(),C()}function S(){let a=document.getElementById("portfolio-filters"),e=document.querySelectorAll("#portfolio-grid .portfolio-item");a&&e.length>0&&a.addEventListener("click",n=>{if(n.target.matches("button.filter-btn")){let i=n.target;if(i.classList.contains("active-filter"))return;a.querySelector(".active-filter").classList.remove("active-filter"),i.classList.add("active-filter");let s=i.dataset.filter;e.forEach(d=>{let o=d.dataset.category,t=s==="all"||o.includes(s);d.style.display=t?"block":"none"})}})}var y=class{constructor(){this.elements={widgetButton:document.getElementById("chat-widget-button"),window:document.getElementById("chat-window"),closeButton:document.getElementById("close-chat-window"),sendButton:document.getElementById("chat-send"),input:document.getElementById("chat-input"),messages:document.getElementById("chat-messages")},this.elements.widgetButton&&(this.n8nWebhookUrl="https://n8n.srv1033442.hstgr.cloud/webhook/34b5ab96-ecf0-4195-93de-e3923c2062e5",this.sessionIdKey="nelson_chat_session_id",this.sessionId=this.getOrCreateSessionId(),this.historyKey=`nelson_chat_history_${this.sessionId}`,this.history=[],this.loadHistory(),this.addEventListeners())}getOrCreateSessionId(){let e=localStorage.getItem(this.sessionIdKey);return e||(e=Date.now().toString(36)+Math.random().toString(36).substring(2),localStorage.setItem(this.sessionIdKey,e)),e}loadHistory(){let e=sessionStorage.getItem(this.historyKey);e&&(this.history=JSON.parse(e),this.history.forEach(n=>{this.appendMessage(n.message,n.sender,!1)}))}addEventListeners(){this.elements.widgetButton.addEventListener("click",()=>this.toggleWindow()),this.elements.closeButton.addEventListener("click",()=>this.toggleWindow()),this.elements.sendButton.addEventListener("click",()=>this.sendMessage()),this.elements.input.addEventListener("keypress",e=>{e.key==="Enter"&&this.sendMessage()})}toggleWindow(){this.elements.window.classList.toggle("hidden"),this.elements.window.classList.contains("hidden")||(this.elements.input.focus(),this.history.length===0&&this.appendMessage("\xA1Hola! Soy Aurelio, tu asistente virtual. \xBFEn qu\xE9 puedo ayudarte?","bot"))}sendMessage(){let e=this.elements.input.value.trim();e!==""&&(this.appendMessage(e,"user"),this.elements.input.value="",this.showTypingIndicator(),this.sendToWebhook(e,this.sessionId))}async sendToWebhook(e,n){try{let s=await(await fetch(this.n8nWebhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,sessionId:n})})).json();this.removeTypingIndicator();let d=s.response||"Lo siento, no he podido procesar tu mensaje. Por favor, intenta de nuevo.";this.appendMessage(d,"bot")}catch(i){console.error("Error sending message to n8n:",i),this.removeTypingIndicator(),this.appendMessage("Lo siento, ha ocurrido un error de conexi\xF3n. Por favor, int\xE9ntalo m\xE1s tarde.","bot")}}createBubble(e,n){let i=document.createElement("div");return i.className=`py-2 px-4 inline-block max-w-xs ${n==="user"?"bg-primary-blue text-white rounded-t-lg rounded-bl-lg":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-t-lg rounded-br-lg"}`,i.innerHTML=e,i.querySelectorAll("a").forEach(s=>s.classList.add("text-blue-500","underline")),i}createTimestamp(){let e=new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),n=document.createElement("div");return n.className="text-xs text-gray-500 dark:text-gray-400 mt-1",n.textContent=e,n}appendMessage(e,n,i=!0){i&&(this.history.push({message:e,sender:n}),sessionStorage.setItem(this.historyKey,JSON.stringify(this.history)));let s=document.createElement("div");s.className=`mb-4 flex flex-col ${n==="user"?"items-end":"items-start"} animate-chat-message-in`;let d=this.createBubble(e,n),o=this.createTimestamp();s.appendChild(d),s.appendChild(o),this.elements.messages.appendChild(s),this.elements.messages.scrollTop=this.elements.messages.scrollHeight}showTypingIndicator(){let e=document.createElement("div");e.id="typing-indicator",e.className="mb-4",e.innerHTML=`
      <div class="bg-gray-200 dark:bg-gray-700 rounded-lg py-2 px-4 inline-block">
        <div class="flex items-center space-x-1">
          <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse"></span>
          <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></span>
          <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></span>
        </div>
      </div>`,this.elements.messages.appendChild(e),this.elements.messages.scrollTop=this.elements.messages.scrollHeight}removeTypingIndicator(){let e=document.getElementById("typing-indicator");e&&e.remove()}};document.addEventListener("DOMContentLoaded",()=>{new y});document.addEventListener("DOMContentLoaded",()=>{E(),L(),I(),k(),S(),a();function a(){function o(r){if(r){let m=r.querySelector("iframe[data-src]");m&&!m.src&&(m.src=m.dataset.src),r.classList.remove("hidden"),r.classList.add("flex"),document.body.classList.add("overflow-hidden")}}function t(r){r&&(r.classList.add("hidden"),r.classList.remove("flex"),document.body.classList.remove("overflow-hidden"))}[{cardId:"card-proyecto-locutorio",modalId:"proyecto-modal-locutorio"},{cardId:"card-proyecto-barberia",modalId:"proyecto-modal-barberia"},{cardId:"card-proyecto-kuula",modalId:"proyecto-modal-kuula"}].forEach(r=>{let m=document.getElementById(r.cardId),f=document.getElementById(r.modalId);m&&f&&m.addEventListener("click",()=>o(f))});let l=document.querySelectorAll('[id^="service-modal-"], [id^="proyecto-modal-"]');l.length>0&&(l.forEach(r=>{let m=r.querySelector('button[id^="close-modal-"]');m&&m.addEventListener("click",()=>t(r)),r.addEventListener("click",f=>{f.target===r&&t(r)}),r.querySelectorAll(".modal-contact-button").forEach(f=>{f.addEventListener("click",()=>t(r))})}),window.addEventListener("keydown",r=>{r.key==="Escape"&&l.forEach(m=>{m.classList.contains("hidden")||t(m)})}))}e();function e(){let o=document.querySelector("#contact-form");if(o){let t=document.getElementById("form-status"),c=o.querySelector('button[type="submit"]');o.addEventListener("submit",async function(l){if(l.preventDefault(),!o.checkValidity()){o.reportValidity(),t&&(t.textContent="Por favor, completa todos los campos requeridos.",t.className="text-center font-semibold mt-4 text-red-600",setTimeout(()=>{t.textContent=""},5e3));return}let r=new FormData(o);t&&(t.textContent="Enviando...",t.className="text-center font-semibold mt-4 text-gray-600 dark:text-gray-300"),c&&(c.disabled=!0);try{(await fetch(o.action,{method:"POST",body:r,headers:{Accept:"application/json"}})).ok?(t&&(t.textContent="\xA1Mensaje enviado con \xE9xito!",t.className="text-center font-semibold mt-4 text-green-600",setTimeout(()=>{t.textContent=""},5e3)),o.reset()):t&&(t.textContent="Hubo un error al enviar el mensaje. Int\xE9ntalo de nuevo.",t.className="text-center font-semibold mt-4 text-red-600",setTimeout(()=>{t.textContent=""},5e3))}catch{t&&(t.textContent="Hubo un problema de conexi\xF3n. Revisa tu internet.",t.className="text-center font-semibold mt-4 text-red-600",setTimeout(()=>{t.textContent=""},5e3))}finally{c&&setTimeout(()=>{c.disabled=!1},3e3)}})}}n();function n(){if(document.getElementById("contact-reveal-container")){let t=document.getElementById("reveal-email-btn"),c=document.getElementById("reveal-phone-btn");t&&t.addEventListener("click",l=>{l.currentTarget.outerHTML=`
          <a href="mailto:contacto@nelsonlondono.es" class="text-primary-blue dark:text-primary-green font-semibold hover:underline flex items-center">
            <i class="fas fa-envelope mr-2"></i>contacto@nelsonlondono.es
          </a>`},{once:!0}),c&&c.addEventListener("click",l=>{l.currentTarget.outerHTML=`
          <a href="tel:+34663975428" class="text-primary-blue dark:text-primary-green font-semibold hover:underline flex items-center">
            <i class="fas fa-phone mr-2"></i>+34 663 97 54 28
          </a>`},{once:!0})}}i();function i(){let o="nelson_cookie_consent",t=document.getElementById("cookie-banner"),c=document.getElementById("cookie-settings-modal"),l=document.getElementById("analytics-cookie-toggle"),r=document.getElementById("open-cookie-settings"),m=document.getElementById("cookie-accept"),f=document.getElementById("cookie-reject"),v=document.getElementById("cookie-settings-open"),b=document.getElementById("cookie-settings-save");function h(){let u=localStorage.getItem(o);return u?JSON.parse(u):null}function g(u){localStorage.setItem(o,JSON.stringify(u))}function p(){typeof gtag=="function"&&gtag("config","G-124QEKRXHD")}function w(){let u=h();u?(u.analytics&&p(),t&&t.classList.add("hidden")):t&&t.classList.remove("hidden")}r&&r.addEventListener("click",u=>{u.preventDefault();let B=h()||{analytics:!1};l&&(l.checked=B.analytics),c&&c.classList.remove("hidden")}),m&&m.addEventListener("click",()=>{g({necessary:!0,analytics:!0}),p(),t&&t.classList.add("hidden")}),f&&f.addEventListener("click",()=>{g({necessary:!0,analytics:!1}),t&&t.classList.add("hidden")}),v&&v.addEventListener("click",()=>{let u=h()||{analytics:!1};l&&(l.checked=u.analytics),c&&c.classList.remove("hidden")}),b&&b.addEventListener("click",()=>{let u={necessary:!0,analytics:l?l.checked:!1};g(u),u.analytics&&p(),c&&c.classList.add("hidden"),t&&t.classList.add("hidden")}),c&&c.addEventListener("click",u=>{u.target===c&&c.classList.add("hidden")}),w()}s();function s(){let o=document.getElementById("hero-iframe-container");o&&o.addEventListener("click",()=>{let t=document.getElementById("hero-iframe-placeholder"),c=document.getElementById("hero-iframe");c&&c.dataset.src&&(c.src=c.dataset.src,t&&t.classList.add("hidden"),c.classList.remove("hidden"),o.style.cursor="default")},{once:!0})}function d(){let o=document.getElementById("share-linkedin"),t=document.getElementById("share-whatsapp");if(o&&t){let c=window.location.href,l=document.title,r=document.querySelector('meta[name="description"]').getAttribute("content");c&&l&&r&&(o.href=`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(c)}&title=${encodeURIComponent(l)}&summary=${encodeURIComponent(r)}`,o.target="_blank",o.rel="noopener noreferrer",t.href=`https://api.whatsapp.com/send?text=${encodeURIComponent(l+" - Link: "+c)}`,t.target="_blank",t.rel="noopener noreferrer")}}d()});})();
