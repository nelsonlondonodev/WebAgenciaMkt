(()=>{function I(){let a=document.getElementById("darkModeToggle");if(a){let e=["auto","light","dark"],t=localStorage.getItem("theme")||"auto",i=r=>{if(r==="auto"){let s=window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",s)}else document.documentElement.classList.toggle("dark",r==="dark")},o=r=>{let s=a.querySelector("i");s&&(s.classList.remove("fa-sun","fa-moon","fa-circle-half-stroke"),r==="light"?s.classList.add("fa-sun"):r==="dark"?s.classList.add("fa-moon"):s.classList.add("fa-circle-half-stroke"))};a.addEventListener("click",()=>{let s=(e.indexOf(t)+1)%e.length;t=e[s],localStorage.setItem("theme",t),i(t),o(t)}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{t==="auto"&&i("auto")}),i(t),o(t)}}function L(){document.body.classList.add("fade-in");function a(t){let i=document.querySelector(t);if(i){let o=document.getElementById("mainHeader")?.offsetHeight||80,s=i.getBoundingClientRect().top+window.pageYOffset-o;window.scrollTo({top:s,behavior:"smooth"})}}function e(t,i){document.body.classList.add("fade-out"),setTimeout(()=>{i?(a(t),setTimeout(()=>{document.body.classList.remove("fade-out")},50)):window.location.href=t},300)}document.querySelectorAll('a:not([href^="tel:"]):not([href^="mailto:"]):not(.social-share-btn):not(.modal-contact-button):not([target="_blank"])').forEach(t=>{t.addEventListener("click",function(i){let o=this.getAttribute("href");if(!o||o==="#")return;let r=o.startsWith("#"),s=r||o.split("#")[0]===window.location.pathname.split("/").pop()||o.split("#")[0]==="";(this.hostname===window.location.hostname||o.startsWith("/"))&&(i.preventDefault(),e(o,r&&s))})})}function k(){let a=document.querySelectorAll(".scroll-animate-initial");if(a.length>0&&typeof IntersectionObserver<"u"){let e=new IntersectionObserver(t=>{t.forEach(i=>{i.isIntersecting&&(i.target.classList.add("is-visible"),e.unobserve(i.target))})},{threshold:.1});a.forEach((t,i)=>{t.style.transitionDelay=`${30*i}ms`,e.observe(t)})}}function q(){let a=document.getElementById("mobileMenuButton"),e=document.getElementById("mobileMenu"),t=document.getElementById("mobileServicesButton");if(!a||!e)return;let i=()=>{if(!e.classList.contains("hidden")){e.classList.add("hidden");let o=a.querySelector("i");o&&(o.classList.remove("fa-times"),o.classList.add("fa-bars"))}};a.addEventListener("click",o=>{o.stopPropagation(),e.classList.toggle("hidden");let r=a.querySelector("i");r&&(r.classList.toggle("fa-bars"),r.classList.toggle("fa-times"))}),e.addEventListener("click",o=>{o.target.closest("a")&&(o.target.closest("#mobileServicesButton")||i())}),document.addEventListener("click",o=>{!e.contains(o.target)&&!a.contains(o.target)&&i()})}function N(){let a=document.getElementById("mobileServicesButton"),e=document.getElementById("mobileServicesMenu");!a||!e||a.addEventListener("click",t=>{t.stopPropagation(),e.classList.toggle("hidden");let i=a.querySelector("i.fa-chevron-down");i&&i.classList.toggle("rotate-180")})}function A(){let a=document.querySelectorAll("section[id]"),e=document.querySelectorAll("header nav a");if(a.length===0||e.length===0)return;let t={root:null,rootMargin:"0px 0px -60% 0px",threshold:0},i=new IntersectionObserver(o=>{o.forEach(r=>{if(r.isIntersecting){let s=r.target.id;e.forEach(n=>{n.classList.remove("nav-active"),n.getAttribute("href")===`#${s}`&&n.classList.add("nav-active")})}})},t);a.forEach(o=>{i.observe(o)})}function O(){let a=document.getElementById("services-menu-group"),e=document.getElementById("services-menu-dropdown"),t;!a||!e||(a.addEventListener("mouseenter",()=>{clearTimeout(t),e.classList.remove("hidden")}),a.addEventListener("mouseleave",()=>{t=setTimeout(()=>{e.classList.add("hidden")},300)}))}function w(){q(),N(),A(),O()}function x(){let a=document.getElementById("portfolio-filters"),e=document.querySelectorAll("#portfolio-grid .portfolio-item");a&&e.length>0&&a.addEventListener("click",t=>{if(t.target.matches("button.filter-btn")){let i=t.target;if(i.classList.contains("active-filter"))return;a.querySelector(".active-filter").classList.remove("active-filter"),i.classList.add("active-filter");let o=i.dataset.filter;e.forEach(r=>{let s=r.dataset.category,n=o==="all"||s.includes(o);r.style.display=n?"block":"none"})}})}function D(a,e,t,i,o=0){let r=null;function s(n){r===null&&(r=n);let c=n-r,d=Math.min(c/i,1),l=e<t,m=t-e,f=e+m*d;d===1?a.textContent=parseFloat(t).toFixed(o):a.textContent=f.toFixed(o),d<1&&requestAnimationFrame(s)}requestAnimationFrame(s)}function S(){let a=document.querySelectorAll(".animate-number");if(a.length===0)return;let e=new IntersectionObserver((t,i)=>{t.forEach(o=>{if(o.isIntersecting){let r=o.target,s=parseFloat(r.dataset.endValue),n=parseFloat(r.dataset.startValue)||0,c=parseInt(r.dataset.duration,10)||2e3,d=parseInt(r.dataset.decimals,10)||0;if(isNaN(s)){console.error("El atributo data-end-value no es un n\xFAmero v\xE1lido.",r);return}D(r,n,s,c,d),i.unobserve(r)}})},{threshold:.5});a.forEach(t=>{e.observe(t)})}var y=async(a,e)=>{try{let t=await fetch(e);if(!t.ok)throw new Error(`Error al cargar el componente ${e}: ${t.statusText}`);let i=await t.text(),o=document.querySelector(a);o?o.innerHTML=i:console.warn(`No se encontr\xF3 el elemento con el selector: ${a}`)}catch(t){console.error(`No se pudo cargar el componente desde ${e}:`,t)}},B=async()=>{await y("#nav-placeholder","/components/nav.html"),await y("#footer-placeholder","/components/footer.html"),await y("#cookie-banner-placeholder","/components/cookie-banner.html")};var M=()=>{let a=document.getElementById("currentYear");a&&(a.textContent=new Date().getFullYear())};var v=class{constructor(){this.elements={widgetButton:document.getElementById("chat-widget-button"),window:document.getElementById("chat-window"),closeButton:document.getElementById("close-chat-window"),sendButton:document.getElementById("chat-send"),input:document.getElementById("chat-input"),messages:document.getElementById("chat-messages")},this.elements.widgetButton&&(this.n8nWebhookUrl="https://n8n.srv1033442.hstgr.cloud/webhook/34b5ab96-ecf0-4195-93de-e3923c2062e5",this.sessionIdKey="nelson_chat_session_id",this.sessionId=this.getOrCreateSessionId(),this.historyKey=`nelson_chat_history_${this.sessionId}`,this.history=[],this.loadHistory(),this.addEventListeners())}getOrCreateSessionId(){let e=localStorage.getItem(this.sessionIdKey);return e||(e=Date.now().toString(36)+Math.random().toString(36).substring(2),localStorage.setItem(this.sessionIdKey,e)),e}loadHistory(){let e=sessionStorage.getItem(this.historyKey);e&&(this.history=JSON.parse(e),this.history.forEach(t=>{this.appendMessage(t.message,t.sender,!1)}))}addEventListeners(){this.elements.widgetButton.addEventListener("click",()=>this.toggleWindow()),this.elements.closeButton.addEventListener("click",()=>this.toggleWindow()),this.elements.sendButton.addEventListener("click",()=>this.sendMessage()),this.elements.input.addEventListener("keypress",e=>{e.key==="Enter"&&this.sendMessage()})}toggleWindow(){this.elements.window.classList.toggle("hidden"),this.elements.window.classList.contains("hidden")||(this.elements.input.focus(),this.history.length===0&&this.appendMessage("\xA1Hola! Soy Aurelio, tu asistente virtual. \xBFEn qu\xE9 puedo ayudarte?","bot"))}sendMessage(){let e=this.elements.input.value.trim();e!==""&&(this.appendMessage(e,"user"),this.elements.input.value="",this.showTypingIndicator(),this.sendToWebhook(e,this.sessionId))}async sendToWebhook(e,t){try{let o=await(await fetch(this.n8nWebhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,sessionId:t})})).json();this.removeTypingIndicator();let r=o.response||"Lo siento, no he podido procesar tu mensaje. Por favor, intenta de nuevo.";this.appendMessage(r,"bot")}catch(i){console.error("Error sending message to n8n:",i),this.removeTypingIndicator(),this.appendMessage("Lo siento, ha ocurrido un error de conexi\xF3n. Por favor, int\xE9ntalo m\xE1s tarde.","bot")}}createBubble(e,t){let i=document.createElement("div");return i.className=`py-2 px-4 inline-block max-w-xs ${t==="user"?"bg-primary-blue text-white rounded-t-lg rounded-bl-lg":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-t-lg rounded-br-lg"}`,i.innerHTML=e,i.querySelectorAll("a").forEach(o=>o.classList.add("text-blue-500","underline")),i}createTimestamp(){let e=new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),t=document.createElement("div");return t.className="text-xs text-gray-500 dark:text-gray-400 mt-1",t.textContent=e,t}appendMessage(e,t,i=!0){i&&(this.history.push({message:e,sender:t}),sessionStorage.setItem(this.historyKey,JSON.stringify(this.history)));let o=document.createElement("div");o.className=`mb-4 flex flex-col ${t==="user"?"items-end":"items-start"} animate-chat-message-in`;let r=this.createBubble(e,t),s=this.createTimestamp();o.appendChild(r),o.appendChild(s),this.elements.messages.appendChild(o),this.elements.messages.scrollTop=this.elements.messages.scrollHeight}showTypingIndicator(){let e=document.createElement("div");e.id="typing-indicator",e.className="mb-4",e.innerHTML=`
      <div class="bg-gray-200 dark:bg-gray-700 rounded-lg py-2 px-4 inline-block">
        <div class="flex items-center space-x-1">
          <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse"></span>
          <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></span>
          <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></span>
        </div>
      </div>`,this.elements.messages.appendChild(e),this.elements.messages.scrollTop=this.elements.messages.scrollHeight}removeTypingIndicator(){let e=document.getElementById("typing-indicator");e&&e.remove()}};document.addEventListener("DOMContentLoaded",()=>{new v});document.addEventListener("DOMContentLoaded",async()=>{await B(),I(),L(),k(),w(),x(),S(),M(),a();function a(){function s(l){if(l){let m=l.querySelector("iframe[data-src]");m&&!m.src&&(m.src=m.dataset.src),l.classList.remove("hidden"),l.classList.add("flex"),document.body.classList.add("overflow-hidden")}}function n(l){l&&(l.classList.add("hidden"),l.classList.remove("flex"),document.body.classList.remove("overflow-hidden"))}[{cardId:"card-proyecto-locutorio",modalId:"proyecto-modal-locutorio"},{cardId:"card-proyecto-barberia",modalId:"proyecto-modal-barberia"},{cardId:"card-proyecto-kuula",modalId:"proyecto-modal-kuula"}].forEach(l=>{let m=document.getElementById(l.cardId),f=document.getElementById(l.modalId);m&&f&&m.addEventListener("click",()=>s(f))});let d=document.querySelectorAll('[id^="service-modal-"], [id^="proyecto-modal-"]');d.length>0&&(d.forEach(l=>{let m=l.querySelector('button[id^="close-modal-"]');m&&m.addEventListener("click",()=>n(l)),l.addEventListener("click",f=>{f.target===l&&n(l)}),l.querySelectorAll(".modal-contact-button").forEach(f=>{f.addEventListener("click",()=>n(l))})}),window.addEventListener("keydown",l=>{l.key==="Escape"&&d.forEach(m=>{m.classList.contains("hidden")||n(m)})}))}e();function e(){let s=document.querySelector("#contact-form");if(s){let n=document.getElementById("form-status"),c=s.querySelector('button[type="submit"]');s.addEventListener("submit",async function(d){if(d.preventDefault(),!s.checkValidity()){s.reportValidity(),n&&(n.textContent="Por favor, completa todos los campos requeridos.",n.className="text-center font-semibold mt-4 text-red-600",setTimeout(()=>{n.textContent=""},5e3));return}let l=new FormData(s);n&&(n.textContent="Enviando...",n.className="text-center font-semibold mt-4 text-gray-600 dark:text-gray-300"),c&&(c.disabled=!0);try{(await fetch(s.action,{method:"POST",body:l,headers:{Accept:"application/json"}})).ok?(n&&(n.textContent="\xA1Mensaje enviado con \xE9xito!",n.className="text-center font-semibold mt-4 text-green-600",setTimeout(()=>{n.textContent=""},5e3)),s.reset()):n&&(n.textContent="Hubo un error al enviar el mensaje. Int\xE9ntalo de nuevo.",n.className="text-center font-semibold mt-4 text-red-600",setTimeout(()=>{n.textContent=""},5e3))}catch{n&&(n.textContent="Hubo un problema de conexi\xF3n. Revisa tu internet.",n.className="text-center font-semibold mt-4 text-red-600",setTimeout(()=>{n.textContent=""},5e3))}finally{c&&setTimeout(()=>{c.disabled=!1},3e3)}})}}t();function t(){if(document.getElementById("contact-reveal-container")){let n=document.getElementById("reveal-email-btn"),c=document.getElementById("reveal-phone-btn");n&&n.addEventListener("click",d=>{d.currentTarget.outerHTML=`
          <a href="mailto:contacto@nelsonlondono.es" class="text-primary-blue dark:text-primary-green font-semibold hover:underline flex items-center">
            <i class="fas fa-envelope mr-2"></i>contacto@nelsonlondono.es
          </a>`},{once:!0}),c&&c.addEventListener("click",d=>{d.currentTarget.outerHTML=`
          <a href="tel:+34663975428" class="text-primary-blue dark:text-primary-green font-semibold hover:underline flex items-center">
            <i class="fas fa-phone mr-2"></i>+34 663 97 54 28
          </a>`},{once:!0})}}i();function i(){let s="nelson_cookie_consent",n=document.getElementById("cookie-banner"),c=document.getElementById("cookie-settings-modal"),d=document.getElementById("analytics-cookie-toggle"),l=document.getElementById("open-cookie-settings"),m=document.getElementById("cookie-accept"),f=document.getElementById("cookie-reject"),b=document.getElementById("cookie-settings-open"),E=document.getElementById("cookie-settings-save");function h(){let u=localStorage.getItem(s);return u?JSON.parse(u):null}function g(u){localStorage.setItem(s,JSON.stringify(u))}function p(){typeof gtag=="function"&&gtag("config","G-124QEKRXHD")}function C(){let u=h();u?(u.analytics&&p(),n&&n.classList.add("hidden")):n&&n.classList.remove("hidden")}l&&l.addEventListener("click",u=>{u.preventDefault();let T=h()||{analytics:!1};d&&(d.checked=T.analytics),c&&c.classList.remove("hidden")}),m&&m.addEventListener("click",()=>{g({necessary:!0,analytics:!0}),p(),n&&n.classList.add("hidden")}),f&&f.addEventListener("click",()=>{g({necessary:!0,analytics:!1}),n&&n.classList.add("hidden")}),b&&b.addEventListener("click",()=>{let u=h()||{analytics:!1};d&&(d.checked=u.analytics),c&&c.classList.remove("hidden")}),E&&E.addEventListener("click",()=>{let u={necessary:!0,analytics:d?d.checked:!1};g(u),u.analytics&&p(),c&&c.classList.add("hidden"),n&&n.classList.add("hidden")}),c&&c.addEventListener("click",u=>{u.target===c&&c.classList.add("hidden")}),C()}o();function o(){let s=document.getElementById("hero-iframe-container");s&&s.addEventListener("click",()=>{let n=document.getElementById("hero-iframe-placeholder"),c=document.getElementById("hero-iframe");c&&c.dataset.src&&(c.src=c.dataset.src,n&&n.classList.add("hidden"),c.classList.remove("hidden"),s.style.cursor="default")},{once:!0})}function r(){let s=document.getElementById("share-linkedin"),n=document.getElementById("share-whatsapp");if(s&&n){let c=window.location.href,d=document.title,l=document.querySelector('meta[name="description"]').getAttribute("content");c&&d&&l&&(s.href=`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(c)}&title=${encodeURIComponent(d)}&summary=${encodeURIComponent(l)}`,s.target="_blank",s.rel="noopener noreferrer",n.href=`https://api.whatsapp.com/send?text=${encodeURIComponent(d+" - Link: "+c)}`,n.target="_blank",n.rel="noopener noreferrer")}}r()});})();
